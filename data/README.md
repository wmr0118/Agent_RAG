# 测试知识库说明

## 文档结构

本知识库包含以下文档，用于测试 Agent-RAG 系统的各项功能：

```
data/raw/
├── 01-产品介绍/
│   ├── 01-产品概述.md          # 产品定位、核心功能、技术架构
│   └── 02-核心功能.md          # 用户管理、工单系统、智能机器人、API集成
├── 02-快速开始/
│   ├── 03-注册登录.md          # 注册步骤、登录方式、首次配置
│   └── 04-首次配置.md          # 企业信息、渠道接入、工作设置、知识库初始化
├── 03-功能指南/
│   ├── 06-用户管理.md          # 创建用户、编辑用户、权限管理、批量操作
│   ├── 07-权限设置.md          # RBAC模型、角色管理、权限分配
│   └── 08-工单系统.md          # 工单创建、状态流转、分配、查询、统计
├── 04-API文档/
│   ├── 10-REST-API.md         # API认证、接口说明、错误码、限流规则
│   └── 11-Webhook配置.md      # Webhook配置、事件格式、签名验证、重试机制
└── 05-故障排除/
    └── 12-常见问题.md          # FAQ集合，涵盖账户、登录、用户管理、工单、API等
```

## 数据特点

### 1. 数据清洗前后对比

**清洗前（模拟原始数据）：**
- 包含模板噪声："本产品是一款..."、"欢迎使用..."
- 低信息密度文本："详情见文档"、"更多信息..."
- 结构不统一：格式混乱，缺少标题层级

**清洗后（当前文档）：**
- 去除模板噪声
- 统一文档结构（标题+正文）
- 提高信息密度（具体操作步骤、技术参数）

### 2. 高频/低频知识划分

**高频知识（200条）：**
- 账户注册登录
- 基础操作（创建用户、创建工单）
- 常见问题FAQ

**中频知识（250条）：**
- 功能配置
- 权限设置
- 工单管理

**低频知识（150条）：**
- API技术细节
- Webhook配置
- 高级功能

### 3. 三级索引结构

**一级索引（文档摘要）：**
- 每份文档生成200字摘要
- 用于主题级快速检索

**二级索引（语义段落）：**
- 文档分割为200-400字的语义段落
- 用于语义相似度检索

**三级索引（细粒度chunk）：**
- 进一步分割为50-200字的chunk
- 用于精确匹配和上下文补充

## 测试用例

### 测试文件

- `test_set.json`: 基础测试集（3条）
- `test_queries.json`: 完整测试集（25条）

### 测试类型

1. **基础操作查询**（简单问题）
   - 如何创建用户？
   - 如何创建工单？

2. **模糊查询**（测试query改写）
   - "用户怎么弄？" → 应改写为"如何创建用户"
   - "创健用户" → 应纠正错别字

3. **长问题简化**（测试query改写）
   - "我想了解一下如何在系统中创建一个新的用户账户，需要哪些步骤？" → 简化为"如何创建用户"

4. **短问题扩展**（测试query改写）
   - "创建用户" → 扩展为"如何创建用户账户"

5. **复杂推理**（测试ReAct Agent）
   - "如何配置多租户权限？" → 需要多步推理，检索多个文档

6. **故障排除**（测试二次检索）
   - "登录失败怎么办？" → 需要检索多个相关文档

7. **低频知识**（测试语义增强）
   - "如何验证Webhook请求签名？" → 需要详细技术说明

## 预期指标

### 检索指标（目标）

- **Recall@5**: > 0.75
- **Recall@10**: > 0.85
- **MRR**: > 0.65

### 生成指标（目标）

- **答案质量**: > 0.7（人工评分）
- **事实准确性**: > 0.8
- **一致性**: > 0.75

### 系统指标

- **平均响应时间**: < 2秒
- **索引构建时间**: < 5分钟

## 使用说明

### 1. 构建索引

```bash
python main.py --mode build_index --data_path data/raw/
```

### 2. 测试查询

```bash
# 单次查询
python main.py --mode query --question "如何创建用户？"

# 使用Agent模式
python main.py --mode query --question "如何配置多租户权限？" --use_agent
```

### 3. 运行评估

```python
from src.evaluation.evaluator import Evaluator
from src.core.rag_chain import RAGChain
from src.utils.config import get_config

config = get_config()
rag_chain = RAGChain(config=config)
evaluator = Evaluator(rag_chain=rag_chain, config=config)

test_set = evaluator.load_test_set("data/test_queries.json")
results = evaluator.evaluate(test_set)
print(results)
```

## 数据统计

- **文档总数**: 10份
- **总字数**: 约15,000字
- **知识单元**: 约600条（文档分割后）
- **FAQ数量**: 约50条（在常见问题文档中）
- **测试用例**: 25条

## 注意事项

1. 文档已进行清洗，去除了模板噪声和低信息文本
2. 文档结构统一，便于索引和检索
3. 包含高频和低频知识，用于测试不同场景
4. 测试用例涵盖多种查询类型，用于验证系统功能

